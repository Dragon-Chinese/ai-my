
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as le}from"./index.vue_vue_type_script_setup_true_lang-ChYkabeB.js";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang-BR6dcXr4.js";import{d as ne,ag as oe,j as re,aA as ue,x as ie,r as L,au as N,aB as ce,y as fe,z as j,o as de,ap as v,a9 as pe,aC as A,A as S,g as f,w as h,b as o,c as k,p as d,L as O,B as J,s as C,n as ve,t as Q,F as q,h as G,e as p,C as me,ad as he,aa as M,ab as I,Q as xe,l as ge}from"./index-CT_znvxk.js";import ye from"./index-D5VLX_Ha.js";import{_ as _e}from"./item.vue_vue_type_script_setup_true_lang-DxUuIVby.js";const ke={class:"h-12 flex flex-shrink-0 items-center"},be={class:"h-full w-14 flex-center"},Re=["onKeydown"],we={key:0,class:"h-full w-14 flex-center border-s"},Se={class:"w-full flex justify-between px-4 py-3"},Ce={class:"flex gap-8"},Me={class:"inline-flex items-center gap-1 text-xs"},Ie={class:"inline-flex items-center gap-1 text-xs"},Be={key:0,class:"inline-flex items-center gap-1 text-xs"},Ve=["data-index","onClick","onMouseover"],ze={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},Te={class:"truncate text-start text-base font-bold"},$e={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ee={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ue=ne({name:"Search",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(W){const x=oe(W,"modelValue"),X=ge(),b=re(),B=ue(),Y=ie(),c=L(""),D=N("searchInputRef"),{focused:Z}=ce(D),V=L([]),n=L(-1),z=N("searchResultRef"),w=N("searchResultItemRef"),g=fe(()=>{let a=[];return a=V.value.filter(e=>{let s=!1;return c.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(c.value)&&(s=!0):e.title.includes(c.value)&&(s=!0)),e.path.includes(c.value)&&(s=!0),B.getRouteMatchedByPath(e.path).some(l=>{var i,t,r,u;return typeof((i=l.meta)==null?void 0:i.title)=="function"?(t=l.meta)==null?void 0:t.title().includes(c.value):(u=(r=l.meta)==null?void 0:r.title)==null?void 0:u.includes(c.value)})&&(s=!0)),s}),a});j(()=>x.value,a=>{a?(c.value="",n.value=-1,v("up",T),v("down",$),v("enter",E),v("esc",e=>{b.settings.navSearch.enableHotkeys&&(e.preventDefault(),x.value=!1)})):(v.unbind("up",T),v.unbind("down",$),v.unbind("enter",E),v.unbind("esc"))}),j(()=>g.value,()=>{n.value=-1,F()}),de(()=>{ee(),v("command+k, ctrl+k",a=>{b.settings.navSearch.enableHotkeys&&(a.preventDefault(),x.value=!0)})}),pe(()=>{v.unbind("command+k, ctrl+k")});function ee(){V.value=[],Y.allMenus.forEach(a=>{U(a.children)})}function te(a){var s;let e=!0;return(s=a.children)!=null&&s.every(l=>{var i;return((i=l.meta)==null?void 0:i.menu)===!1})&&(e=!1),e}function U(a,e,s){a.forEach(l=>{var i,t,r,u,m;((i=l.meta)==null?void 0:i.menu)!==!1&&(l.children&&te(l)?U(l.children,A(e,l.path),((t=l.meta)==null?void 0:t.icon)??s):V.value.push({path:A(e,l.path),icon:((r=l.meta)==null?void 0:r.icon)??s,title:(u=l.meta)==null?void 0:u.title,link:(m=l.meta)==null?void 0:m.link}))})}function T(){g.value.length&&(n.value-=1,n.value<0&&(n.value=g.value.length-1),F())}function $(){g.value.length&&(n.value+=1,n.value>g.value.length-1&&(n.value=0),F())}function E(){var a,e;n.value!==-1&&((e=(a=w.value)==null?void 0:a.find(s=>Number.parseInt(s.dataset.index)===n.value))==null||e.click())}function F(){var a,e,s,l,i,t,r,u;if((l=(s=(e=(a=z.value)==null?void 0:a.areaRef)==null?void 0:e.ref)==null?void 0:s.el)!=null&&l.viewportElement){const m=z.value.areaRef.ref.el.viewportElement;let y=0;if(n.value!==-1){y=m.scrollTop;const _=((t=(i=w.value)==null?void 0:i.find(H=>Number.parseInt(H.dataset.index)===n.value))==null?void 0:t.offsetTop)??0,R=((u=(r=w.value)==null?void 0:r.find(H=>Number.parseInt(H.dataset.index)===n.value))==null?void 0:u.clientHeight)??0,K=m.scrollTop,P=m.clientHeight;_+R>K+P?y=_+R-P:_<=K&&(y=_-16)}m.scrollTo({top:y})}}function se(a,e){e?window.open(e,"_blank"):X.push(a),x.value=!1}return(a,e)=>{const s=ve,l=ae,i=le;return f(),S(i,{ref_key:"searchResultRef",ref:z,modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),border:"",footer:d(b).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0",onOpened:e[4]||(e[4]=t=>Z.value=!0)},{header:h(()=>[o("div",ke,[o("div",be,[p(s,{name:"i-ri:search-line",class:"size-4 text-foreground/30"})]),me(o("input",{ref_key:"searchInputRef",ref:D,"onUpdate:modelValue":e[0]||(e[0]=t=>xe(c)?c.value=t:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=M(I(t=>x.value=!1,["prevent"]),["esc"])),M(I(T,["prevent"]),["up"]),M(I($,["prevent"]),["down"]),M(I(E,["prevent"]),["enter"])]},null,40,Re),[[he,d(c)]]),d(b).mode==="mobile"?(f(),k("div",we,[p(s,{name:"i-carbon:close",class:"size-4",onClick:e[2]||(e[2]=t=>x.value=!1)})])):C("",!0)])]),footer:h(()=>[o("div",Se,[o("div",Ce,[o("div",Me,[p(l,null,{default:h(()=>[p(s,{name:"i-ion:md-return-left",class:"size-4"})]),_:1}),e[5]||(e[5]=o("span",null,"访问",-1))]),o("div",Ie,[p(l,null,{default:h(()=>[p(s,{name:"i-ant-design:caret-up-filled",class:"size-4"})]),_:1}),p(l,null,{default:h(()=>[p(s,{name:"i-ant-design:caret-down-filled",class:"size-4"})]),_:1}),e[6]||(e[6]=o("span",null,"切换",-1))])]),d(b).settings.navSearch.enableHotkeys?(f(),k("div",Be,[p(l,null,{default:h(()=>e[7]||(e[7]=[G(" ESC ")])),_:1}),e[8]||(e[8]=o("span",null,"退出",-1))])):C("",!0)])]),default:h(()=>[o("div",null,[d(g).length>0?(f(!0),k(q,{key:0},O(d(g),(t,r)=>(f(),k("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:w,key:t.path,class:"p-4","data-index":r,onClick:u=>se(t.path,t.link),onMouseover:u=>n.value=r},[o("a",{class:J(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":r!==0,"bg-accent":r===d(n)}])},[t.icon?(f(),S(s,{key:0,name:t.icon,class:J(["size-5 basis-16 transition",{"scale-120 text-primary":r===d(n)}])},null,8,["name","class"])):C("",!0),o("div",ze,[o("div",Te,Q((typeof t.title=="function"?t.title():t.title)??"[ 无标题 ]"),1),d(B).getRouteMatchedByPath(t.path).length?(f(),S(ye,{key:0,class:"truncate"},{default:h(()=>[(f(!0),k(q,null,O(d(B).getRouteMatchedByPath(t.path),(u,m)=>(f(),S(_e,{key:m,class:"text-xs"},{default:h(()=>{var y,_,R;return[G(Q((typeof((y=u.meta)==null?void 0:y.title)=="function"?(_=u.meta)==null?void 0:_.title():(R=u.meta)==null?void 0:R.title)??"[ 无标题 ]"),1)]}),_:2},1024))),128))]),_:2},1024)):C("",!0)])],2)],40,Ve))),128)):d(c)===""?(f(),k("div",$e,[p(s,{name:"i-tabler:mood-smile",class:"size-10"}),e[9]||(e[9]=o("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(f(),k("div",Ee,[p(s,{name:"i-tabler:mood-empty",class:"size-10"}),e[10]||(e[10]=o("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))])]),_:1},8,["modelValue","footer"])}}});export{Ue as default};
