
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as K,au as x,y as d,c as h,g as c,F as m,e as w,A as y,s as g,p as n,av as T,aw as z,T as $,W as F,ax as A,w as H,ao as I,B as E,ae as v,L,f as N,ay as k,at as J}from"./index-CT_znvxk.js";import{_ as O,r as W}from"./item.vue_vue_type_style_index_0_lang-CvHfwg1v.js";const D=K({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(S){const s=S,p=s.menu.path??JSON.stringify(s.menu),M=x("itemRef"),C=x("subMenuRef"),t=z(W),b=d(()=>t.openedMenus.includes(s.uniqueKey.at(-1))),q=d(()=>t.isMenuPopup?{enter(e){e.offsetHeight>window.innerHeight&&(e.style.height=`${window.innerHeight}px`)},afterEnter:()=>{},beforeLeave:e=>{e.style.maxHeight=`${e.offsetHeight}px`,e.style.overflow="hidden"},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""}}:CSS.supports("height","calc-size(auto, size)")?{}:{enter(e){requestAnimationFrame(()=>{e.dataset.height=e.offsetHeight.toString(),e.style.maxHeight="0",e.offsetHeight,e.style.maxHeight=`${e.dataset.height}px`,e.style.overflow="hidden"})},afterEnter(e){e.style.maxHeight="",e.style.overflow=""},enterCancelled(e){e.style.maxHeight="",e.style.overflow=""},beforeLeave(e){e.style.maxHeight=`${e.offsetHeight}px`,e.style.overflow="hidden"},leave(e){e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""},leaveCancelled(e){e.style.maxHeight="",e.style.overflow=""}}),P=d(()=>t.isMenuPopup?{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}:{enterActiveClass:"ease-in-out duration-300",enterFromClass:v("opacity-0 translate-y-4 scale-95 blur-4",CSS.supports("height","calc-size(auto, size)")&&"h-0"),enterToClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveToClass:v("opacity-0 translate-y-4 scale-95 blur-4",CSS.supports("height","calc-size(auto, size)")&&"h-0")}),r=d(()=>{var e;return((e=s.menu.children)==null?void 0:e.some(i=>{var a;return((a=i.meta)==null?void 0:a.menu)!==!1}))??!1});function R(){t.isMenuPopup&&r.value||(r.value?t.handleSubMenuClick(p,s.uniqueKey):t.handleMenuItemClick(p))}let u;function _(){t.isMenuPopup&&(t.mouseInMenu=s.uniqueKey,u==null||u(),{stop:u}=k(()=>{if(r.value)t.openMenu(p,s.uniqueKey),J(()=>{var o,f;const e=(o=M.value)==null?void 0:o.ref,i=(f=C.value)==null?void 0:f.$el;if(!e||!i)return;let a=0,l=0;t.props.mode==="vertical"||s.level!==0?(a=e.getBoundingClientRect().top+e.scrollTop,l=e.getBoundingClientRect().left+e.getBoundingClientRect().width,a+i.offsetHeight>window.innerHeight&&(a=Math.max(0,window.innerHeight-i.offsetHeight))):(a=e.getBoundingClientRect().top+e.getBoundingClientRect().height,l=e.getBoundingClientRect().left,a+i.offsetHeight>window.innerHeight&&(i.style.height=`${window.innerHeight-a}px`)),l+i.offsetWidth>document.documentElement.clientWidth&&(l=e.getBoundingClientRect().left-e.getBoundingClientRect().width),i.style.top=`${a}px`,i.style.insetInlineStart=`${l}px`});else{const e=s.menu.children?t.subMenus[p].indexPath.at(-1):t.items[p].indexPath.at(-1);t.openMenu(e,t.subMenus[e].indexPath)}},300))}function B(){t.isMenuPopup&&(t.mouseInMenu=[],u==null||u(),{stop:u}=k(()=>{t.mouseInMenu.length===0?t.closeMenu(s.uniqueKey):r.value&&!t.mouseInMenu.includes(s.uniqueKey.at(-1))&&t.closeMenu(s.uniqueKey.at(-1))},300))}return(e,i)=>{const a=N("SubMenu"),l=I;return c(),h(m,null,[w(O,{ref_key:"itemRef",ref:M,"unique-key":e.uniqueKey,item:e.menu,level:e.level,"sub-menu":n(r),expand:n(b),onClick:R,onMouseenter:_,onMouseleave:B},null,8,["unique-key","item","level","sub-menu","expand"]),n(r)?(c(),y(T,{key:0,to:"body",disabled:!n(t).isMenuPopup},[w($,F(n(P),A(n(q))),{default:H(()=>[n(b)?(c(),y(l,{key:0,ref_key:"subMenuRef",ref:C,scrollbar:!1,mask:n(t).isMenuPopup,class:E(n(v)("sub-menu static h-[calc-size(auto,size)] rounded-lg",{"bg-[var(--g-sub-sidebar-bg)]":n(t).isMenuPopup,"border shadow-xl fixed z-3000 w-[200px]":n(t).isMenuPopup,"mx-1":n(t).isMenuPopup&&(n(t).props.mode==="vertical"||e.level!==0),"py-1":n(t).isMenuPopup}))},{default:H(()=>[(c(!0),h(m,null,L(e.menu.children,o=>{var f;return c(),h(m,{key:o.path??JSON.stringify(o)},[((f=o.meta)==null?void 0:f.menu)!==!1?(c(),y(a,{key:0,"unique-key":[...e.uniqueKey,o.path??JSON.stringify(o)],menu:o,level:e.level+1},null,8,["unique-key","menu","level"])):g("",!0)],64)}),128))]),_:1},8,["mask","class"])):g("",!0)]),_:1},16)],8,["disabled"])):g("",!0)],64)}}});export{D as _};
